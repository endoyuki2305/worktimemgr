# worktimemgr

社員の出退勤を月別にまとめ、給与計算時に利用します。出退勤データは各社員が毎日、スマートフォンあるいはPCからSlackの自社ワークスペース、#timesheets内に呟く。それを[勤怠管理bot - みやもとさん](https://github.com/masuidrive/miyamoto)を通じてGoogle Spreadsheetに書き込む。

みやもとさんは残業時間、月別勤務時間集計などの機能が未実装である為、それら機能はユーザーが実装する必要がある。worktimemgr(仮名)は、各社員の出退勤シートから指定月のデータを抽出し、休憩時間タイムシートで定義された休憩時間を引いた勤務時間を算出する。

image::https://user-images.githubusercontent.com/12984133/54501774-9ebc1c80-496a-11e9-8205-501cf584d8fe.png[miyamotosan]

image::https://user-images.githubusercontent.com/12984133/54505816-fa8fa100-497c-11e9-8d15-ecd765a5c0da.png[workingtime]

```
@startuml みやもとさんシーケンス図
hide footbox

participant ユーザ
participant Slack
participant みやもとさん
participant GoogleSheets

ユーザ -> Slack : 出退勤を呟く
Slack -> みやもとさん : Outgoing Webhooks

activate みやもとさん
  みやもとさん -> GoogleSheets : 出退勤時刻を保存
  Slack <-- みやもとさん : Incoming Webhooks
deactivate みやもとさん

ユーザ <- Slack : 戻りメッセージ
@enduml

@startuml 月間勤務時間計算シーケンス図
hide footbox
participant ユーザ
participant GAS
participant 個人別出退勤シート
participant 客先別休憩残業時間シート
participant 月間勤務時間シート

ユーザ -> 月間勤務時間シート : 年、月、ユーザ名、客先名を入力

activate 月間勤務時間シート
  GAS <- 月間勤務時間シート : セル内関数が自動起動
deactivate 月間勤務時間シート

activate GAS
  GAS -> 個人別出退勤シート : 指定月の出退勤データを取得
  GAS -> 客先別休憩残業時間シート : 客先の休憩残業時間を取得
  GAS -> 月間勤務時間シート : 出退勤時刻から勤務時間を算出
deactivate GAS

  ユーザ -> GAS : 実勤務時間を算出
activate GAS
  GAS -> 月間勤務時間シート : 休憩時間、残業時間を算出
deactivate GAS
@enduml
```
